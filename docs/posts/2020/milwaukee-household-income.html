<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mike Gousha and John Johnson">
<meta name="dcterms.date" content="2020-10-30">

<title>By one key measure, household income, metro Milwaukee is worse off than it was in 1980 – John Johnson’s Internet Archive</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-bde7cfe73309ee1b4eca639e0a08c217.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-31XDQG3G4L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-31XDQG3G4L', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">John Johnson’s Internet Archive</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Table of Contents</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../external-links.html"> 
<span class="menu-text">External Links</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bluebookmke.substack.com/"> 
<span class="menu-text">Blue Book Newsletter</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#where-the-data-came-from" id="toc-where-the-data-came-from" class="nav-link active" data-scroll-target="#where-the-data-came-from">Where the data came from</a></li>
  <li><a href="#the-role-of-manufacturing" id="toc-the-role-of-manufacturing" class="nav-link" data-scroll-target="#the-role-of-manufacturing">The role of manufacturing</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">By one key measure, household income, metro Milwaukee is worse off than it was in 1980</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mike Gousha and John Johnson </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 30, 2020</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><em>This article <a href="https://www.jsonline.com/in-depth/news/solutions/2020/10/30/milwaukee-worse-off-now-than-1980-based-household-income/6041254002/">originally appeared</a> in the Milwaukee Journal Sentinel.</em></p>
<p>“Are you better off than you were four years ago?”</p>
<p>That question, asked by Republican presidential candidate Ronald Reagan in 1980, was pivotal in the race for the White House.</p>
<p>So, in the spirit of this election year, let’s ask the question again, but with a twist.</p>
<p>Is the metro Milwaukee area better off today than it was 40 years ago, in 1980, the year of Reagan’s famous words?</p>
<p>The economic impact of the COVID-19 outbreak makes that a tricky question. Some people would argue that given the moment, the answer is “no.” But even before the pandemic hit, metro Milwaukee was faring worse than it did in 1980 in a key measurement of economic prosperity: median household income.</p>
<p>In real dollars, adjusted for inflation, households today in our metropolitan area earn less than they did 40 years ago.</p>
<p>The city of Milwaukee has seen the sharpest decline in income, followed by the Milwaukee County suburbs. But perhaps surprisingly, suburbs and communities in the WOW counties — Waukesha, Ozaukee, and Washington — have also struggled, especially in recent years.</p>
<p>The data used for this story was compiled and analyzed as part of the Milwaukee Area Project at Marquette University Law School’s Lubar Center for Public Policy Research and Civic Education.</p>
<p>It reinforces some of what we know about our metro area.</p>
<p>There is a large wealth gap between the city and the communities that surround it, as well as big differences in white and minority household income.</p>
<p>But the data also reveals a region — arguably the economic engine of the state — still struggling to find its footing after two recessions, one in the early 2000s and the Great Recession of 2008. Our household income growth lagged the nation even before we were hit by a third economic contraction brought on by the COVID-19 pandemic.</p>
<section id="where-the-data-came-from" class="level2">
<h2 class="anchored" data-anchor-id="where-the-data-came-from">Where the data came from</h2>
<p>Before we take a closer look at the data, let’s talk about where we got it. We calculated demographic and household income using individual Census interviews from the Integrated Public Use Microdata Series (IPUMS USA at the University of Minnesota). The most recent data is from 2018.</p>
<p>National income data is from the Census Bureau’s Current Population Survey Annual Social and Economic Supplement.</p>
<p>Wage data is from the Quarterly Census of Employment and Wages conducted by the Bureau of Labor Statistics. The most recent data is from 2019.</p>
<p>We focus in this story on median household income rather than per capita income. Median household income includes all income earned by those living in a household. That could mean families, unmarried couples, or singles. We think it’s the most accurate way to measure economic prosperity. Here’s why: Rapidly growing wages among the richest workers can raise per person averages even when people in the middle see no improvement. Also, many of the largest expenses are made at the household level, so two people earning $40,000 each are better off economically when they live together, even though their per capita income is unchanged.</p>
<p>When we compare household income from one year to another, we adjust for inflation. We’re talking about “real dollars.”</p>
<p>And we use the U.S. Census Bureau’s definition of the Milwaukee metro area — Milwaukee, Waukesha, Ozaukee, and Washington counties.</p>
<p>To understand what’s happened in metro Milwaukee since 1980, it’s helpful to note what has and hasn’t changed during the last four decades.</p>
<p>Household size has remained remarkably consistent since 1980. Forty years ago, the average household in the city of Milwaukee had 2.5 members; now it is 2.4. The average suburban household had 2.8 members in 1980 and 2.3 now. This larger decline is mostly because there are fewer suburban families with kids at home. The share of households with one earner compared to two has changed very little in either the city or the suburbs since 1980.</p>
<p>What has changed is the region’s geographic and economic balance of power during the last four decades.</p>
<p>The city’s share of the metro’s population shrank.</p>
<p>Milwaukee County suburbs’ share remained about the same.</p>
<p>Population in the WOW counties grew.</p>
<p>In 1980, 31% of the residents of metro Milwaukee lived outside Milwaukee County. Today, nearly 40% do. But the WOW counties’ evolution from commuter suburbs to full participant in the metro economy is the bigger story. In 1980, 15% of metro Milwaukee’s jobs were in the WOW counties. Today that number is 42%.</p>
<p>But what about the region’s relative prosperity?</p>
<p>In 1980, the nation’s median household income was $54,000. The city of Milwaukee closely mirrored that number, at $53,000. But by 2018 — the last year for which data was available — the nation’s median household income had grown to $64,000. The city’s household income had fallen to $44,000.</p>
<p>The city’s suburbs and surrounding areas remain relatively prosperous compared to the rest of the nation, and especially the city. But even their median household income today — $73,000 — is $5,000 less than it was in 1980.</p>
<p>Some of the decline can be traced to events in the first decade of the 21st century. Times were tough for the average American household. The nation experienced two economic downturns, including the Great Recession of 2008.</p>
<p>Metro Milwaukee is still trying to recover.</p>
<p>Milwaukee has become a poorer city since the turn of the century. In real dollars, households in Milwaukee today earn $6,000 a year less than they did in 2000.</p>
<p>Residents outside the city experienced the same downward trend. Median household income in the suburbs and outlying areas peaked at $86,000 in 2000. Since then, income has fallen $13,000 dollars per household. In Waukesha, the largest and wealthiest suburban county, incomes declined $8,000. Median incomes fell $14,000 in Ozaukee County and $13,000 in Washington County.</p>
<p>While they both saw declines, the economic fortunes of the suburbs and the city they surround couldn’t be more different. The median household outside the city earns nearly $30,000 a year more than a household in the city.</p>
<p>The metro area’s racial disparity is glaring. Household income for Black and Latino residents today is less than what it was in 1980. Black residents today have a median household income of $30,000 in the city and $39,000 in the suburbs. Latino residents have a median household income of $45,000 in the city and $52,000 in the suburbs.</p>
<p>What has happened to Black household income in Milwaukee is especially concerning. Since 1980, it has declined significantly across the board. The poorest households became poorer. Middle-class household income fell roughly 20%. That stands in stark contrast to the U.S. average for black households, which showed at least some household income growth across all income groups.</p>
<p>In 1980, a middle-class Black family in Milwaukee could expect to earn about $6,000 more than the national average for Black households. Now, a middle-income Black family in Milwaukee earns around $10,000 less.</p>
<p>White residents of the metro area fare significantly better. Median household income today is $56,000 in the city and $77,000 in the suburbs. When adjusting for inflation, that’s roughly the same as it was in 1980.</p>
<p>One interesting finding in our analysis was this: Consistent with the “back-to-the-city” phenomenon, white city of Milwaukee residents were least-harmed by the Great Recession. Urban white households were the only group in our data to have almost completely recovered financially.</p>
<p>Metro Milwaukee’s household income trends have moved in the opposite direction of national trends. We’re lagging the nation in growth. The question is why.</p>
<p>After all, since 2000, most occupations saw their average annual wages rise. In addition, labor force participation rates remained remarkably consistent. There are somewhat fewer men now in the workforce, but that difference has been made up by women.</p>
<p>A closer examination of data from the Bureau of Labor Statistics reveals what’s happened.</p>
</section>
<section id="the-role-of-manufacturing" class="level2">
<h2 class="anchored" data-anchor-id="the-role-of-manufacturing">The role of manufacturing</h2>
<p>The impact of the Great Recession saw metro Milwaukee shed 68,000 jobs from 2000 to 2010. But in the years that followed, the economy added back about 62,000 jobs, leaving us with about 6,000 fewer jobs than we had 19 years ago.</p>
<p>And 4,400 of the jobs lost were in the public sector.</p>
<p>Prior to the pandemic, the private sector had basically recovered all its job losses during the Great Recession. But dig a little deeper, and you see a significant change that explains the decline in the region’s household income: the disappearance of thousands of higher-earning jobs.</p>
<p>Manufacturing still accounts for 16% of private-sector jobs in metro Milwaukee. But today, there are 45,000 fewer manufacturing jobs than there were in 2000 — only 10 metros have lost more. Manufacturing jobs pay an average of $67,000 a year.</p>
<p>There are also 7,000 fewer jobs in the finance and insurance sector. Those jobs pay an average of $100,000 a year.</p>
<p>Many other traditional middle-income jobs have also declined in number.</p>
<p>In contrast, the metro economy has added jobs in lower-paying sectors. For example, from 2000 to 2019, metro Milwaukee added 13,000 jobs in the accommodation and food service workers sector, which includes servers, cooks, and food preparation workers. The average wage is $18,000 a year.</p>
<p>The largest employer in the metro Milwaukee area today is the health care/social assistance sector. That includes registered nurses, nursing assistants, and personal care aides.</p>
<p>That sector accounts for nearly 19% of the region’s private-sector jobs. It’s also the fastest-growing sector. Since 2000, we’ve added 37,000 health care and social assistance jobs. They pay an average wage of $48,000, $19,000 less than the average manufacturing job.</p>
<p>The region is seeing exponential growth in one higher-paid sector of the economy: “management of companies and enterprises.” Think private equity and management firms.</p>
<p>Those jobs, with an average wage of $115,000 a year, still amount to only 3.5% of metro Milwaukee’s private sector employment. But they have tripled in number in the last two decades, an additional 15,000 high-paying jobs for the area. Only five metros have added more jobs in this category. Collectively, these jobs bring home 7.4% of the Milwaukee metro’s wages, contributing to an increase in overall per capita earnings that doesn’t extend down the income ladder.</p>
<p>There are other contributing factors to metro Milwaukee’s decline in median household income. As we mentioned, the metro area shed 4,400 public sector jobs in the last decade. Those jobs typically pay middle-class wages.</p>
<p>In addition, the population in the WOW counties is aging. The number of suburban households not participating in the labor market has increased from 19% in 1980 to 27% in 2018.</p>
<p>We estimate a fifth of suburban households are entirely composed of retirees over the age of 60, compared to just 13% in the city. These suburban retiree households have a median income of $35,000, so their growing share of the population is one of the sources of the decline in household incomes.</p>
<p>The story of household income in metro Milwaukee bears some resemblance to other Midwestern cities, but not in a good way. In real dollars, Detroit and Cleveland have also seen their median household income decline since 1980, and by an even larger amount than Milwaukee.</p>
<p>Some other Midwestern metros have fared better. Household income for metro Indianapolis is the same as it was in 1980. The Chicago, Kansas City, and St.&nbsp;Louis metro areas have seen a modest increase, while Madison and Minneapolis have seen significant gains.</p>
<p>As we reported in June of this year, metro Milwaukee’s population has been in a slow or no-growth mode since 2000. That is reflected in employment numbers. Despite two recessions in the 2000-2010 decade, the Minneapolis, Indianapolis, and Kansas City metro areas all added tens of thousands of employees to their economies from 2000 to 2019. The Minneapolis-St.&nbsp;Paul metro added 235,000. Indianapolis added 201,000. Both had such strong population and jobs growth that their metro areas physically expanded. Kansas City added 92,000 employees.</p>
<p>In contrast, metro Milwaukee lost more than 6,200 employees during that period. That performance ranked Milwaukee 309th out of 352 metro areas, but it was still better than Detroit, which lost 152,000 employees, and Cleveland, which lost 87,000.</p>
<p>Metro Milwaukee fared slightly better in the category of average pay increase. Since 2000, average pay has climbed $3,500, but that increase still put us in the bottom third among metro areas.</p>
<p>A lot has changed in metro Milwaukee since 1980 when Ronald Reagan famously asked voters if they were better off than they were four years ago. But at least one of those changes has not been for the better; the prosperity of its people today is not what it was it was four decades ago. And that was before COVID-19.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>